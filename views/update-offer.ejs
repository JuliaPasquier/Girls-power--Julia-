<%- include('partials/header') %>


    <%- include('partials/nav') %>

        <h2 class="title">Update offer</h2>

        <form class="update-offer" method="POST">

            <label for="jobTitle">Job Title</label>
            <input type="text" name="jobTitle" value="<%= offer.jobTitle %>" required />


            <label for="url">Website</label>
            <input type="text" name="url" value="<%= offer.url %>" required />


            <label for="employerName">Name</label>
            <input type="text" name="employerName" value="<%= offer.employerName %>" required />


            <label for="employerEmail">Email</label>
            <input type="text" name="employerEmail" value="<%= offer.employerEmail %>" required />


            <label for="employerPhone">Phone</label>
            <input type="text" name="employerPhone" value="<%= offer.employerPhone %>" />


            <label for="employerAddress">Address</label>
            <input type="text" name="employerAddress" value="<%= offer.employerAddress %>" />


            <label for="offerOrigin">Origin</label>
            <input type="text" name="offerOrigin" value="<%= offer.offerOrigin %>" />

            <label for="offerStatus">Status</label>

            <select name="offerStatus" id="offerStatus" value="<%= offer.offerStatus %>">
                <option value="interested">Interested</option>
                <option value="CV">Resume</option>
                <option value="Negative">Negative</option>
                <option value="Interview">Interview</option>
            </select>


            <label for="comments">Comments</label>
            <input type="text" name="comments" value="<%= offer.comments %>" />

            <input class="btn" type="submit" value="Update" />
            <input class="btn" type="submit" value="delete" />

        </form>


        <%- include('partials/footer') %>

            <script>
                const form = document.querySelector('update-offer');
                form.addEventListener("submit", async (e) => {
                    e.preventDefault();


                    const jobTitle = form.jobTitle.value;
                    const url = form.url.value;
                    const employerName = form.employerName.value;
                    const employerEmail = form.employerEmail.value;
                    const employerPhone = form.employerPhone.value;
                    const employerAddress = form.employerAddress.value;
                    const offerOrigin = form.offerOrigin.value;
                    const offerStatus = form.offerStatus.value;
                    const comments = form.comments.value;
                    console.log("Je suis dans l'event listner")
                    try {
                        console.log("Je lance le post")
                        const res = await fetch("/update-offer", {
                            method: "POST",
                            body: JSON.stringify({ jobTitle, url, employerName, employerEmail, employerPhone, employerAddress, offerOrigin, offerStatus, comments }),
                            headers: { "Content-Type": "application/json" },
                        });
                        res.json()
                        if (res.status === 200) {
                            window.location.href = "/";
                        }
                    }
                    catch (err) {
                        console.log(err);

                    }
                });
            </script>